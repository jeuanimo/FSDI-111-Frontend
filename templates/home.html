{% extends "base.html" %} {% block title %}Dashboard - Expense Manager{%
endblock %} {% block content %}
<div class="container">
  <div class="row">
    <div class="col-12">
      <h1 class="display-4 text-center mb-4">
        <i class="bi bi-graph-up text-success"></i> Expense Dashboard
      </h1>
      <p class="lead text-center text-muted mb-3">
        Welcome back, {{ username|default('User') }}! Manage your expenses with
        ease {% if username == 'demo' %}
        <br /><span class="badge bg-info"
          ><i class="bi bi-star"></i> Demo Mode Active</span
        >
        {% endif %}
      </p>
    </div>
  </div>

  <!-- Summary Cards -->
  <div class="row mb-4">
    <div class="col-md-4 mb-3">
      <div class="card bg-primary text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <h4 class="card-title">Total Expenses</h4>
              <h2>
                ${{ "%.2f"|format(expenses|sum(attribute='amount') if expenses
                else 0) }}
              </h2>
            </div>
            <i class="bi bi-arrow-down-circle fs-1"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-4 mb-3">
      <div class="card bg-info text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <h4 class="card-title">Number of Expenses</h4>
              <h2>{{ expenses|length if expenses else 0 }}</h2>
            </div>
            <i class="bi bi-receipt fs-1"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-4 mb-3">
      <div class="card bg-warning text-white">
        <div class="card-body">
          <div class="d-flex justify-content-between">
            <div>
              <h4 class="card-title">Average Expense</h4>
              <h2>
                ${{ "%.2f"|format((expenses|sum(attribute='amount') /
                expenses|length) if expenses and expenses|length > 0 else 0) }}
              </h2>
            </div>
            <i class="bi bi-calculator fs-1"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header bg-primary text-white">
          <h4 class="mb-0"><i class="bi bi-lightning"></i> Quick Actions</h4>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-4 mb-2">
              <button
                class="btn btn-success w-100"
                data-bs-toggle="modal"
                data-bs-target="#addExpenseModal"
              >
                <i class="bi bi-plus-circle"></i> Add Expense
              </button>
            </div>
            <div class="col-md-4 mb-2">
              <button
                class="btn btn-info w-100"
                onclick="window.location.href='/about'"
              >
                <i class="bi bi-info-circle"></i> Learn More
              </button>
            </div>
            <div class="col-md-4 mb-2">
              <button
                class="btn btn-secondary w-100"
                onclick="generateReport()"
              >
                <i class="bi bi-file-earmark-text"></i> Generate Report
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Recent Expenses -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header bg-secondary text-white">
          <h4 class="mb-0">
            <i class="bi bi-clock-history"></i> Your Expenses
          </h4>
        </div>
        <div class="card-body">
          {% if expenses %}
          <div class="table-responsive">
            <table class="table table-hover">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Description</th>
                  <th>Category</th>
                  <th>Amount</th>
                  <th>Charged By</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for expense in expenses %}
                <tr>
                  <td>{{ expense.date if expense.date else 'N/A' }}</td>
                  <td>{{ expense.description }}</td>
                  <td>
                    <span class="badge bg-light text-dark"
                      >{{ expense.category or 'Uncategorized' }}</span
                    >
                  </td>
                  <td class="text-danger">
                    ${{ "%.2f"|format(expense.amount) }}
                  </td>
                  <td>
                    <span class="badge bg-primary">
                      <i class="bi bi-person"></i> {{
                      expense.username|default('Unknown') }}
                    </span>
                  </td>
                  <td>
                    <button
                      class="btn btn-sm btn-outline-primary"
                      onclick="editExpense('{{ expense.id }}')"
                    >
                      <i class="bi bi-pencil"></i>
                    </button>
                    <form
                      method="POST"
                      action="/delete-expense/{{ expense.id }}"
                      style="display: inline"
                      onsubmit="return confirm('Are you sure you want to delete this expense?')"
                    >
                      <button
                        type="submit"
                        class="btn btn-sm btn-outline-danger"
                      >
                        <i class="bi bi-trash"></i>
                      </button>
                    </form>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <div class="text-center text-muted py-5">
            <i class="bi bi-inbox fs-1"></i>
            <h5 class="mt-3">No expenses found</h5>
            <p>Start by adding your first expense to track your spending!</p>
            <button
              class="btn btn-primary"
              data-bs-toggle="modal"
              data-bs-target="#addExpenseModal"
            >
              <i class="bi bi-plus-circle"></i> Add Your First Expense
            </button>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Add Expense Modal -->
<div class="modal fade" id="addExpenseModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">Add New Expense</h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
        ></button>
      </div>
      <form action="/add-expense" method="POST">
        <div class="modal-body">
          <div class="mb-3">
            <label for="expense_description" class="form-label"
              >Description</label
            >
            <input
              type="text"
              class="form-control"
              id="expense_description"
              name="description"
              placeholder="What did you spend on?"
              required
            />
          </div>
          <div class="mb-3">
            <label for="expense_amount" class="form-label">Amount</label>
            <div class="input-group">
              <span class="input-group-text">$</span>
              <input
                type="number"
                step="0.01"
                class="form-control"
                id="expense_amount"
                name="amount"
                placeholder="0.00"
                required
              />
            </div>
          </div>
          <div class="mb-3">
            <label for="expense_category" class="form-label">Category</label>
            <select
              class="form-select"
              id="expense_category"
              name="category"
              required
            >
              <option value="">Select category...</option>
              <option value="Food">Food & Dining</option>
              <option value="Transportation">Transportation</option>
              <option value="Housing">Housing</option>
              <option value="Utilities">Utilities</option>
              <option value="Entertainment">Entertainment</option>
              <option value="Healthcare">Healthcare</option>
              <option value="Shopping">Shopping</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="expense_date" class="form-label">Date</label>
            <input
              type="date"
              class="form-control"
              id="expense_date"
              name="date"
              required
            />
          </div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-secondary"
            data-bs-dismiss="modal"
          >
            Cancel
          </button>
          <button type="submit" class="btn btn-primary">Add Expense</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  // Set today's date as default for date inputs
  document.addEventListener("DOMContentLoaded", function () {
    const today = new Date().toISOString().split("T")[0];
    const dateInput = document.getElementById("expense_date");
    if (dateInput) {
      dateInput.value = today;
    }
  });

  function generateReport() {
    alert("Report generation feature coming soon!");
  }

  function editExpense(expenseId) {
    window.location.href = "/edit-expense/" + expenseId;
  }

  function deleteExpense(expenseId) {
    if (confirm("Are you sure you want to delete this expense?")) {
      // Form submission is handled by the inline form in the template
    }
  }
</script>
{% endblock content %}
